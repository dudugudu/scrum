<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de Prospect</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h2 class="text-center mb-4">Cadastro de Prospect</h2>
      <form id="prospectForm">
        <div class="mb-3">
          <label for="nome" class="form-label">Nome:</label>
          <input type="text" class="form-control" id="nome" name="nome" required />
        </div>

        <div class="mb-3">
          <label for="email" class="form-label">Email:</label>
          <input type="email" class="form-control" id="email" name="email" required />
        </div>

        <div class="mb-3">
          <label for="telefone" class="form-label">Telefone:</label>
          <input type="tel" class="form-control" id="telefone" name="telefone" required />
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <button type="button" class="btn btn-secondary" onclick="voltar()">Voltar</button>
          <button type="submit" class="btn btn-primary">Cadastrar</button>
        </div>
      </form>
    </div>

    <script src="scripts.js"></script>
    <script>
      document.getElementById("prospectForm").onsubmit = async (event) => {
        event.preventDefault();
        const formData = new FormData(document.getElementById("prospectForm"));
        const data = Object.fromEntries(formData);
        
        try {
          const response = await fetch("http://localhost:3000/prospects", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });
          if (!response.ok) throw new Error("Erro ao cadastrar prospect");
          alert("Prospect cadastrado com sucesso!");
          window.location.href = "prospects.html";
        } catch (error) {
          alert(error.message);
        }
      };

      function voltar() {
        window.location.href = "prospects.html";
      }
    </script>

    <div class="container mt-5">
      <h2 class="text-center mb-4">Lista de Prospects</h2>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Nome</th>
            <th>Email</th>
            <th>Telefone</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody id="prospectList"></tbody>
      </table>
    </div>

    <script>
      async function carregarProspects() {
        try {
          const response = await fetch("http://localhost:3000/prospects");
          if (!response.ok) throw new Error("Erro ao buscar prospects");
          const prospects = await response.json();
          const tbody = document.getElementById("prospectList");
          tbody.innerHTML = "";
          prospects.forEach((prospect) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${prospect.nome}</td>
              <td>${prospect.email}</td>
              <td>${prospect.telefone}</td>
              <td>
                <button class="btn btn-warning btn-sm" onclick="editarProspect(${prospect.id})">Editar</button>
                <button class="btn btn-danger btn-sm" onclick="deletarProspect(${prospect.id})">Excluir</button>
              </td>
            `;
            tbody.appendChild(tr);
          });
        } catch (error) {
          console.error(error);
        }
      }

      async function deletarProspect(id) {
        if (!confirm("Tem certeza que deseja excluir este prospect?")) return;
        try {
          const response = await fetch(`http://localhost:3000/prospects/${id}`, {
            method: "DELETE",
          });
          if (!response.ok) throw new Error("Erro ao excluir prospect");
          alert("Prospect excluído com sucesso!");
          carregarProspects();
        } catch (error) {
          alert(error.message);
        }
      }

      function editarProspect(id) {
        window.location.href = `editar_prospect.html?id=${id}`;
      }

      document.addEventListener("DOMContentLoaded", carregarProspects);
    </script>
  </body>
</html>
